---
- name: define dotfile mappings
  set_fact:
    dotfile_mappings:
      # root dotfiles
      - { src: ".triplea.zsh", dest: ".triplea.zsh", type: "file" }

      # config directories
      - { src: ".config/nvim", dest: ".config/nvim", type: "directory" }
      - { src: ".config/fontconfig", dest: ".config/fontconfig", type: "directory" }

      # local directories
      - { src: ".bin", dest: ".bin", type: "directory" }
  tags: dotfiles

- name: ensure parent directories exist
  file:
    path: "{{ ansible_env.HOME }}/{{ item.dest | dirname }}"
    state: directory
    mode: '0755'
  loop: "{{ dotfile_mappings }}"
  when: item.dest | dirname != '.'
  tags: dotfiles

- name: force remove existing dotfiles and directories to avoid conflicts
  file:
    path: "{{ ansible_env.HOME }}/{{ item.dest }}"
    state: absent
  loop: "{{ dotfile_mappings }}"
  tags: dotfiles
